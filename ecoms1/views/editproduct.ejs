<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Product</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-K7U7pm0htdFy4XZKoPIdRnTSjFmMhj1zV9LzmZv5wS+9hSJQVgdE/KdS+1aFqu4t9eDvWGytiufhsRY5Itskag==" crossorigin="anonymous" referrerpolicy="no-referrer" />

   <style>
       body {
           font-family: Arial, sans-serif;
           background-color: #f2f2f2;
           margin: 0;
           padding: 0;
       }

            .app-bar {
        background-color: rgb(4, 43, 17);
        padding: 25px;
        display: flex;
        width: 100%;
        height: 120px;
        align-items: center;
        justify-content: space-between;
        }

        .logo {
        display: flex;
        align-items: center;
        }

        .logo img {
        width: auto;
        height: 150px;
        margin-right: 10px;
        }

        .material-icons {
        padding-top: 20px;
        }

        .logout-button:hover {
        background-color: #535582;
        }

        h1,
        h2 {
        text-align: center;
        margin-bottom: 20px;
        font-family: emoji;
        }

        .person-icon {
        color: white;
        font-size: 35px;
        cursor: pointer;
        }

        .dropdown {
        position: relative;
        display: inline-block;
        }

        .dropdown-menu {
        position: absolute;
        right: 0;
        top: 100%;
        left: auto;
        display: none;
        min-width: 150px;
        padding: 5px 0;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }

        .dropdown-menu a {
        display: block;
        padding: 8px 16px;
        color: #333;
        text-decoration: none;
        transition: background-color 0.3s ease;
        }

        .dropdown-menu a:hover {
        background-color: #e8f2f1;
        }

        .dropdown-menu.show {
        display: block;
        }

        .dropdown > span {
        margin-left: 5px;
        }

        .add-product-button {
        display: block;
        text-align: center;
        padding: 12px 24px;
        font-size: 16px;
        background-color: #4CAF50;
        color: #ffffff;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.3s ease;
        margin-left: 600px;
        display: flex;
        align-items: center;
        }

        .add-product-button i {
        margin-right: 8px;
        }

        .logout-button {
        display: inline-block;
        padding: 12px 24px;
        font-size: 16px;
        background-color: #4CAF50;
        color: #ffffff;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.3s ease;
        }

        .logout-button i {
        margin-right: 8px;
        }

        .add-product-button:hover {
        background-color: #535582;
        }

        #sname{
                margin-left: 350px;
                color: white;
                font-family: emoji;
            }

        #Management{
        color: whitesmoke;
        margin-left: 350px;
        }


       .container {
           background-color: #f2f2f2;
           padding: 20px;
           width: 100%;
           max-width: 1200px;
           margin: 0 auto;
       }

       .form-container {
           background-color: #fff;
           padding: 20px;
           margin-top: 20px;
       }

       label {
           display: block;
           margin-bottom: 10px;
           font-weight: bold;
       }

       input,
       textarea {
           width: 100%;
           padding: 5px;
           margin-bottom: 10px;
           border: 1px solid #ccc;
           border-radius: 4px;
           transition: box-shadow 0.3s ease;
       }

       input:hover,
       textarea:hover {
           box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
       }

       button {
           background-color: #333;
           color: #fff;
           border: none;
           padding: 10px 20px;
           cursor: pointer;
           border-radius: 4px;
           transition: background-color 0.3s ease;
       }

       button:hover {
           background-color: #555;
       }

       .image-container {
           display: flex;
           align-items: center;
           margin-top: 20px;
       }

       .image-container img {
           width: 150px;
           height: auto;
           margin-right: 10px;
           border-radius: 4px;
           box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
       }

       .image-container form {
           display: inline-block;
       }

       .image-container button {
           background-color: #f44336;
           color: #fff;
           border: none;
           padding: 5px 10px;
           cursor: pointer;
           border-radius: 4px;
           transition: background-color 0.3s ease;
       }

       .image-container button:hover {
           background-color: #d32f2f;
       }

       .image-container input[type="file"] {
           margin-bottom: 10px;
       }

       .image-container button.update-image {
           background-color: #4caf50;
           color: #fff;
           border: none;
           padding: 5px 10px;
           cursor: pointer;
           border-radius: 4px;
           transition: background-color 0.3s ease;
       }

       .image-container button.update-image:hover {
           background-color: #45a049;
       }

       h2 {
           margin-top: 30px;
           text-align: center;
           font-size: 20px;
       }

       @media (max-width: 768px) {
           .container {
               padding: 10px;
           }

           .form-container {
               margin-top: 10px;
               padding: 10px;
           }

           input,
           textarea {
               padding: 5px;
           }

           .image-container img {
               width: 100px;
               margin-right: 5px;
           }
            }
       .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-container {
            margin-bottom: 20px;
        }

        .image-container {
            display: flex;
            flex-wrap: wrap;
        }

        .image-container div {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .image-container img {
            width: 200px;
            height: auto;
        }

        .replace-input {
            margin-bottom: 10px;
        }
   </style>
</head>
<body>
    <div class="app-bar">
        <div class="logo">
          <a href="/storedetails/<%= storeId %>">
          <img src="/images/ll.png" alt="Company Logo">
        </a>
      
     <div> 
            
            <h1 id="Management">Store Management System</h1>  
            <h4 id="sname"> <%= name %></h4> </div> 
        </div>
        <div class="dropdown">
          <i class="material-icons person-icon">person</i><span>Profile</span>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="/addproduct/<%= storeId %>">Add Product</a>
            <a class="dropdown-item" href="/editstore/<%= storeId %>">Edit Store Details</a>
          
            <a class="dropdown-item" href="#" onclick="confirmLogout()">Logout</a>
          </div>
        </div>
      </div>
      <button onclick="goBack()">Back</button>

    <div class="container">
        <h1>Edit Product</h1>

        <div class="form-container">
            <form action="/updateproduct/<%= product.storeid %>/<%= product.productid %>" method="POST" onsubmit="return validateForm()">
         
                <label for="productName">Product Name:</label>
                <input type="text" id="productName" name="productName" value="<%= product.productname %>" required>

                <label for="category">Category:</label>
                <input type="text" id="category" name="category" value="<%= product.category %>" required>

                <label for="code">Code:</label>
                <input type="text" id="code" name="code" value="<%= product.code %>" required>

                <label for="hsn">HSN:</label>
                <input type="text" id="hsn" name="hsn" value="<%= product.hsn %>" required>

                <label for="salesPrice">Sales Price:</label>
                <input type="number" id="salesPrice" name="salesPrice" value="<%= product.salesprice %>" required>

                <label for="mrp">MRP:</label>
                <input type="number" id="mrp" name="mrp" value="<%= product.mrp %>" required>

                <label for="qty">Quantity:</label>
                <input type="number" id="qty" name="qty" value="<%= product.qty %>" required>

                <label for="description">Description:</label>
                <textarea id="description" name="description" rows="20" required><%= product.description %></textarea>

                <label for="productImages">Product Images:</label>
                <input type="file" id="productImages" name="productImages" accept="image/*" multiple>                
                <button class="update-image" type="submit">Save</button>

            </form> 

                            <h2>Images</h2>

                            <div class="image-container">
                                <% images.forEach((image) => { %>
                                <div>
                                    <img src="/images/<%= image.imagepath %>" alt="Product Image">
                                    <form class="replace-form" action="/replaceimage/<%= product.productid %>/<%= image.imageid %>" method="post" enctype="multipart/form-data">
                                    <input class="replace-input" type="file" name="newImage" accept="image/*" required>
                                    <input type="hidden" name="imageId" value="<%= image.imageid %>">
                                    <button class="replace-image" type="submit">Replace Image</button>
                                    </form>
                                </div>
                                <% }); %>
                            </div>
                        </div>
                                  
</div>   

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.all.min.js"></script>

    <script>

        function validateForm() {
            var productName = document.getElementById("productName").value;
            var category = document.getElementById("category").value;
            var code = document.getElementById("code").value;
            var hsn = document.getElementById("hsn").value;
            var salesPrice = document.getElementById("salesPrice").value;
            var mrp = document.getElementById("mrp").value;
            var qty = document.getElementById("qty").value;
            var description = document.getElementById("description").value;

            if (productName.trim() === "") {
                alert("Product Name is required");
                return false;
            }

            if (category.trim() === "") {
                alert("Category is required");
                return false;
            }

            if (code.trim() === "") {
                alert("Code is required");
                return false;
            }

            if (hsn.trim() === "") {
                alert("HSN is required");
                return false;
            }

            if (salesPrice.trim() === "") {
                alert("Sales Price is required");
                return false;
            }

            if (mrp.trim() === "") {
                alert("MRP is required");
                return false;
            }

            if (qty.trim() === "") {
                alert("Quantity is required");
                return false;
            }

            if (description.trim() === "") {
                alert("Description is required");
                return false;
            }

            return true;
        }
 
function displayErrorDialog(title, message) {
    Swal.fire({
      title: title,
      text: message,
      icon: 'error',
      confirmButtonText: 'OK',
      customClass: {
        confirmButton: 'swal2-btn',
      },
    });
  }

  function confirmLogout() {
    Swal.fire({
      title: 'Logout Confirmation',
      text: 'Are you sure you want to logout?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, Logout',
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = 'http://localhost:7777';
        history.replaceState(null, null, 'http://localhost:7777');

      } else {
        const errorMessage = 'Logout cancelled.';
        displayErrorDialog('Cancelled', errorMessage);
      }
    });
  }
      const personIcon = $('.person-icon');
      const dropdownMenu = $('.dropdown-menu');
  
      personIcon.on('click', () => {
        dropdownMenu.toggleClass('show');
      });
  
      $(document).on('click', (event) => {
        if (!$(event.target).closest('.dropdown').length) {
          if (dropdownMenu.hasClass('show')) {
            dropdownMenu.removeClass('show');
          }
        }
      });
      
    function goBack() {
  window.history.back(); 
}
    </script>
</body>
</html>